# =========================
# Server
# =========================
# Optional: local HTTP port for the automation API.
PORT=3000
# Optional: control panel port.
PANEL_PORT=4100
# Optional: API base URL that panel uses for health/run checks.
PANEL_API_BASE_URL=http://localhost:3000
# Optional: command used by panel to start the automation API.
# Use 'npm start' for stable mode (recommended) or 'npm run dev' for development with hot-reload.
PANEL_API_START_COMMAND=npm start
# Optional: if true, panel auto-starts the automation API on boot.
PANEL_AUTO_START_API=true
# Optional: auto-open panel URL in browser on startup.
PANEL_AUTO_OPEN=true

# =========================
# Board (local file-based)
# =========================
# Optional: path to the Board directory, relative to CLAUDE_WORKDIR or absolute (default: Board).
BOARD_DIR=Board
# Optional: status values used in frontmatter (must match exactly).
BOARD_STATUS_NOT_STARTED=Not Started
BOARD_STATUS_IN_PROGRESS=In Progress
BOARD_STATUS_DONE=Done
# Optional: type value that represents an Epic.
BOARD_TYPE_EPIC=Epic

# =========================
# Claude execution
# =========================
# Optional: command that runs Claude in non-interactive mode (default: claude --print).
# Override if Claude is installed in a non-standard location.
CLAUDE_COMMAND="claude --print"
# Optional: max timeout per task in ms. Example: 4500000 = 75 minutes.
# Should be higher than WATCHDOG_INTERVAL_MS * WATCHDOG_MAX_WARNINGS.
CLAUDE_TIMEOUT_MS=4500000
# Optional: extra instructions appended to every task prompt.
CLAUDE_EXTRA_PROMPT=
# Required for non-interactive execution: token generated by `claude setup-token`.
CLAUDE_CODE_OAUTH_TOKEN=
# Required: absolute path to the project where Claude will work.
# The Board/ directory must be inside this path.
CLAUDE_WORKDIR=
# Optional: if true, stream Claude stdout/stderr live to the log feed.
CLAUDE_STREAM_OUTPUT=true
# Optional: if true, logs the full prompt sent to Claude.
CLAUDE_LOG_PROMPT=true
# Optional: if true, runs Claude with full-access (no permission prompts).
# This automatically adds `--dangerously-skip-permissions`.
CLAUDE_FULL_ACCESS=true
# Optional: override the Claude model for all tasks (ignores task-level model config).
# Leave empty for automatic mode (uses model from task definition).
# Valid values: claude-opus-4-6, claude-sonnet-4-5-20250929, claude-haiku-4-5-20251001
CLAUDE_MODEL_OVERRIDE=
# Optional: if true, tasks completed by non-Opus models are reviewed by Opus before Done.
OPUS_REVIEW_ENABLED=false
# Optional: if true, completed Epics are reviewed by Opus (tests + full review) before Done.
EPIC_REVIEW_ENABLED=false
# Optional: if true, Claude must create automated tests for each task (when applicable).
FORCE_TEST_CREATION=false
# Optional: if true, Claude must run all tests and ensure they pass before finishing.
FORCE_TEST_RUN=false
# Optional: if true, Claude must create a commit before moving the task to Done.
FORCE_COMMIT=false
# Optional: if true, injects a managed section into the target project's CLAUDE.md
# with automation instructions (AC tracking, response format, general rules).
INJECT_CLAUDE_MD=true
# Optional: if true, enables multi-agent parallel execution for complex tasks.
# Claude will use multiple agents when appropriate to improve speed and quality.
ENABLE_MULTI_AGENTS=false

# =========================
# Queue behavior
# =========================
# Optional: debounce to merge frequent reconciliation triggers (ms).
QUEUE_DEBOUNCE_MS=1500
# Optional: max tasks processed per reconciliation cycle.
MAX_TASKS_PER_RUN=50
# Optional: task ordering. Values: `alphabetical` (default, A-Z by name) or `priority_then_alphabetical`.
QUEUE_ORDER=alphabetical
# Optional: if true, runs one reconciliation cycle as soon as the API starts.
# Note: The orchestrator starts PAUSED by default. You must manually unpause
# via the panel UI (Pause/Resume button) to begin task execution.
QUEUE_RUN_ON_STARTUP=true
# Optional: fallback periodic reconciliation (ms). Set 0 to disable.
# Note: Periodic reconciliation only triggers if orchestrator is NOT paused.
QUEUE_POLL_INTERVAL_MS=60000
# Optional: if true, moves failed tasks back to Not Started.
AUTO_RESET_FAILED_TASK=false

# =========================
# Watchdog (long-running task monitor)
# =========================
# Optional: enable/disable the watchdog timer (default: true).
WATCHDOG_ENABLED=true
# Optional: check interval in ms (default: 1200000 = 20 minutes).
WATCHDOG_INTERVAL_MS=1200000
# Optional: warnings before killing the process (default: 3 = 60min at 20min intervals).
WATCHDOG_MAX_WARNINGS=3
# Optional: consecutive same-task failures before halting the orchestrator (default: 3).
WATCHDOG_MAX_CONSECUTIVE_FAILURES=3
# Optional: consecutive failures across ALL tasks before halting (default: 5).
# Catches systemic issues (auth broken, CLI misconfigured) where different tasks keep failing.
GLOBAL_MAX_CONSECUTIVE_FAILURES=5

# =========================
# Auto-Recovery
# =========================
# Optional: enable/disable auto-recovery when tasks fail (default: true).
AUTO_RECOVERY_ENABLED=true
# Optional: max recovery attempts per task before giving up (default: 2).
AUTO_RECOVERY_MAX_RETRIES=2
# Optional: timeout for recovery execution in ms (default: 300000 = 5 minutes).
AUTO_RECOVERY_TIMEOUT_MS=300000
# Optional: model to use for recovery analysis.
# Valid values: claude-opus-4-6, claude-sonnet-4-5-20250929, claude-haiku-4-5-20251001, auto
# 'auto' uses claude-opus-4-6 for maximum recovery intelligence (default: auto).
AUTO_RECOVERY_MODEL=auto

# =========================
# Local persistence
# =========================
# Optional: local file for execution history and durations.
RUN_STORE_PATH=.data/runs.json

# =========================
# Manual trigger security
# =========================
# Optional: protects POST /run and /resume with Authorization: Bearer <token>.
# Leave empty to disable auth on these endpoints.
MANUAL_RUN_TOKEN=
