# =========================
# Server
# =========================
# Optional: local HTTP port for this service.
PORT=3000
# Optional: Joy UI control panel port.
PANEL_PORT=4100
# Optional: API base URL that panel uses for health/run checks.
PANEL_API_BASE_URL=http://localhost:3000
# Optional: command used by panel to start the automation app.
PANEL_API_START_COMMAND=npm run dev
# Optional: if true, panel auto-starts the automation app on boot.
PANEL_AUTO_START_API=false
# Optional: auto-open panel URL in browser on startup.
PANEL_AUTO_OPEN=true

# =========================
# Notion API (required)
# =========================
# Required: Notion integration token (never commit a real token).
NOTION_API_TOKEN=secret_xxx
# Required: Notion database (kanban) ID.
NOTION_DATABASE_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# Optional: Notion API version; keep this default if unsure.
NOTION_VERSION=2022-06-28

# =========================
# Database property mapping
# Only change these if your property names differ in Notion.
# =========================
# Card title property.
NOTION_PROP_NAME=Name
# Board status property.
NOTION_PROP_STATUS=Status
# Multi-select agents property.
NOTION_PROP_AGENT=Agent
# Priority select property (P0, P1, ...).
NOTION_PROP_PRIORITY=Priority
# Item type property (Epic, UserStory, Defect, Discovery).
NOTION_PROP_TYPE=Type
# Relation from sub-task -> parent item (Notion sub-items).
NOTION_PROP_PARENT_ITEM=Parent item

# =========================
# Status values
# Must exactly match your Notion labels.
# =========================
NOTION_STATUS_NOT_STARTED=Not started
NOTION_STATUS_IN_PROGRESS=In progress
NOTION_STATUS_DONE=Done

# Type value that represents an Epic in your board.
NOTION_TYPE_EPIC=Epic

# =========================
# Claude execution
# =========================
# Optional: command that runs Claude in non-interactive mode (default: claude --print).
CLAUDE_COMMAND="claude --print"
# Optional: max timeout per card in ms. Example: 4500000 = 75 minutes.
# Should be higher than WATCHDOG_INTERVAL_MS * WATCHDOG_MAX_WARNINGS.
CLAUDE_TIMEOUT_MS=4500000
# Optional: extra instructions appended to every task prompt.
CLAUDE_EXTRA_PROMPT=
# Required for non-interactive execution: token generated by `claude setup-token`.
CLAUDE_CODE_OAUTH_TOKEN=
# Optional: folder where Claude runs ('.' = current project folder).
CLAUDE_WORKDIR=.
# Optional: if true, stream Claude stdout/stderr live to terminal.
CLAUDE_STREAM_OUTPUT=true
# Optional: if true, logs the full prompt sent to Claude in your terminal.
CLAUDE_LOG_PROMPT=true
# Optional: if true, runs Claude with full-access (no permission prompts).
# This automatically adds `--dangerously-skip-permissions`.
CLAUDE_FULL_ACCESS=true
# Optional: if true, tasks completed by non-Opus models are reviewed by Opus before Done.
OPUS_REVIEW_ENABLED=false
# Optional: if true, completed Epics are reviewed by Opus (tests + full review) before Done.
EPIC_REVIEW_ENABLED=false
# Optional: if true, Claude must create automated tests for each task (when applicable).
FORCE_TEST_CREATION=false
# Optional: if true, Claude must run all tests and ensure they pass before finishing.
FORCE_TEST_RUN=false
# Optional: if true, Claude must create a commit before moving the task to Done.
FORCE_COMMIT=false

# =========================
# Queue behavior
# =========================
# Optional: debounce to merge frequent reconciliation triggers (ms).
QUEUE_DEBOUNCE_MS=1500
# Optional: max cards processed per reconciliation cycle.
MAX_TASKS_PER_RUN=50
# Optional: next-card ordering (`created` or `priority_then_created`).
QUEUE_ORDER=created
# Optional: if true, runs one reconciliation cycle as soon as the API starts.
QUEUE_RUN_ON_STARTUP=true
# Optional: fallback periodic reconciliation (ms). Set 0 to disable.
QUEUE_POLL_INTERVAL_MS=60000
# Optional: if true, moves failed cards back to Not Started.
AUTO_RESET_FAILED_TASK=false

# =========================
# Watchdog (long-running task monitor)
# =========================
# Optional: enable/disable the watchdog timer (default: true).
WATCHDOG_ENABLED=true
# Optional: check interval in ms (default: 1200000 = 20 minutes).
WATCHDOG_INTERVAL_MS=1200000
# Optional: warnings before killing the process (default: 3 = 60min at 20min intervals).
WATCHDOG_MAX_WARNINGS=3
# Optional: consecutive task failures before halting the orchestrator (default: 3).
WATCHDOG_MAX_CONSECUTIVE_FAILURES=3

# =========================
# Local persistence
# =========================
# Optional: local file for execution history and durations.
RUN_STORE_PATH=.data/runs.json

# =========================
# Manual trigger security
# =========================
# Optional: protects POST /run with Authorization: Bearer <token>.
# Leave empty to disable auth on this endpoint.
MANUAL_RUN_TOKEN=
